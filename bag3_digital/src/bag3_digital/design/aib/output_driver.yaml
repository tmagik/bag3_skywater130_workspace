global:
  sim_params: &sim_params
    vdd: 1.0
    cout: 10.0e-12
    v1: 0
    v2: 1.0
    tper: 10.0e-9
    trf: 100.0e-15
  step_prams: &step_params
    impl_lib: !!null
    view_name: !!null
    layout_package: ''
    layout_class: ''
    root_dir: !!null
    sweep_params:
      dumm: ['']
    env_list: !!null
    dut_wrappers: {}

step_1: # simulation for output resistance
  << : *step_params
  impl_cell: &step_1_dut step_1_dut
  dsn_basename: *step_1_dut
  dut_lib: bag3_digital
  dut_cell: aib_driver_output_model
  summary_fname: *step_1_dut
  schematic_params:
    dumm:     !!null
    lch:      !!null
    seg_p:    !!null
    seg_n:    !!null
    w_p:      !!null
    w_n:      !!null
    stack_p:  !!null
    stack_n:  !!null

  measurements:
    - meas_type: output_res
      meas_package: bag3_digital.design.aib.output_driver
      meas_class: OutputDriverMeasManager
      out_fname: out_res.yaml
      testbenches:
        output_res:
          tb_package : bag3_digital.design.digital_db.db
          tb_class: OutputDriverTBManager
          tb_lib: bag3_testbenches
          tb_cell: driver_output_res_tb
          wrapper_type: ''
          sch_params:
            dut_conns:
              VDD: VDD
              VSS: VSS
              in: in
              out: out
            cout_conns:
              PLUS: out
              MINUS: VSS
            clk_params:
              v1: 0
              v2: vdd
          sim_params: *sim_params


step_2: # simulation for rise/fall time matching at the output (given a sizing for nand and nor)
  << : *step_params
  impl_cell: &step_2_dut step_2_dut
  dsn_basename: *step_2_dut
  dut_lib: bag3_digital
  dut_cell: aib_driver_output_unit_cell
  summary_fname: *step_2_dut
  schematic_params:
    dumm: !!null
    nand_params:
      seg:  !!null
      lch:  !!null
      w_p:  !!null
      w_n:  !!null
      th_n: 'standard'
      th_p: 'standard'
    nor_params:
      seg:  !!null
      lch:  !!null
      w_p:  !!null
      w_n:  !!null
      th_n: 'standard'
      th_p: 'standard'
    output_stage_params:
      lch:    !!null
      w_p:  !!null
      w_n:  !!null
      th_p: 'standard'
      th_n: 'standard'
      seg_p:    !!null
      seg_n:    !!null
      stack_p:  !!null
      stack_n:  !!null
    export_inter_pins: True

  measurements:
    - meas_type: trf
      meas_package: bag3_digital.design.aib.output_driver
      meas_class: OutputDriverMeasManager
      out_fname: trf.yaml
      testbenches:
        tr_tf:
          tb_package: bag3_digital.design.aib.output_driver
          tb_class: OutputDriverTBManager
          tb_lib: bag3_testbenches
          tb_cell: driver_output_res_tb
          wrapper_type: ''
          sch_params:
            dut_conns:
              VDD: VDD
              VSS: VSS
              in: in
              out: out
              en: VDD
              enb: VSS
              v_pu: nand_out
              v_pd: nor_out
            cout_conns:
              PLUS: out
              MINUS: VSS
            clk_params:
              v1: 0
              v2: vdd
          sim_params: *sim_params

step_3: # simulation for lvlshifter_unitcell verification
  <<: *step_params
  impl_cell: &step_3_dut step_3_dut
  dsn_basename: *step_3_dut
  dut_lib: bag3_digital
  dut_cell: aib_driver_lvl_shifter_model_wrapper
  summary_fname: *step_3_dut
  schematic_params:
    dumm: !!null
    lvl_shifter_params:
      lch: 36
      seg_dict:
        pd: 27 # 112
        pu: 9 # 48
        rst: 54 # 256
      w_dict:
        pd: 2
        pu: 2
        rst: 2
      stack_dict:
        pd: 2
        pu: 1
        rst: 1
      intent_dict:
        nch: 'standard'
        pch: 'standard'
      inv_params:
        inv_params:
          - seg: 64
            lch: 36
            w_p: 2
            w_n: 2
            th_p: 'standard'
            th_n: 'standard'
            stack: 1
      remove_out_inv: 3
    inv_params:
      inv_params:
        - seg: 5 # 16
          lch: 36
          w_p: 2
          w_n: 2
          th_p: 'standard'
          th_n: 'standard'
          stack: 1
      show_outb: True
      export_pins: False
    vdd_input: vdd_core
    export_tb_pins:
      - inb
      - midn
      - midp
    lvl_term:
      rst_lb: VDD_in
      rst_hb: VDD_in
      in: in
      inb: inbbuf
      midn: midn
      midp: midp

  measurements:
    - meas_type: trf
      meas_package: bag3_digital.design.aib.output_driver
      meas_class: OutputDriverMeasManager
      out_fname: lvlshifter
      plot_figs: False
      testbenches:
        tdelay:
          tb_package: bag3_digital.design.digital_db.db
          tb_class: OutputDriverTBManager
          tb_lib: bag3_testbenches
          tb_cell: driver_output_res_tb
          wrapper_type: ''
          sch_params:
            dut_conns:
              VDD: VDD
              VSS: VSS
              in: in
              inbuf: inbuf
              inbbuf: inbbuf
              out: out
              outb: outb
              midp: midp
              midn: midn
            cout_conns:
              PLUS: midn
              MINUS: VSS
            clk_params:
              v1: 0
              v2: vdd_core
          sim_params:
            <<: *sim_params
            vdd_core: 0.8
            egain: 1

step4: # simulation for lvlshifter + pre and post inverters given the design of output driver


step5: # simulation for the end2end behavior and final adjustment



